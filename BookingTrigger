trigger BookingTrigger on Booking__c (after insert, after update) {

    if (Trigger.isAfter) {

        if (Trigger.isInsert) {
            // Create Booking Payment and Guest records
            BookingTriggerHandler.createPaymentRecords(Trigger.new);
            BookingTriggerHandler.createBookingGuests(Trigger.new);  
        }

        else if (Trigger.isUpdate) {  
            Set<Id> bookingIdsToSend = new Set<Id>();

            for (Booking__c booking : Trigger.new) {
                Booking__c oldBooking = Trigger.oldMap.get(booking.Id);

                // Check for status change to "Confirmed"
                if (booking.Booking_Status__c == 'Confirmed' && 
                    (oldBooking.Booking_Status__c == null || oldBooking.Booking_Status__c != 'Confirmed')) {
                    bookingIdsToSend.add(booking.Id);
                }
            }

            if (!bookingIdsToSend.isEmpty()) {
                BookingConfirmationEmailer.sendBookingConfirmation(bookingIdsToSend);
            }
        }
    }
}